!function(){"use strict";const e=document.querySelector(".profile__edit-btn"),t=(document.querySelector(".profile__edit-name"),document.querySelector(".profile__about-me"),document.querySelector(".js-input-type-profile-name")),s=document.querySelector(".js-input-type-profile-about-me"),r=document.querySelector(".popup__edit-form"),n=document.querySelector(".profile__add-places-btn"),i=(document.querySelector(".js-input-type-place-name"),document.querySelector(".js-input-type-place-url"),document.querySelector(".popup__place-form")),o=document.querySelector(".profile__image-edit-btn"),a=document.querySelector(".popup__edit-profile-pic-form"),l=document.querySelector(".cards__list"),c={formSelector:".popup__form",inputSelector:".popup__form-input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input-type-error",errorClass:"popup__error_visible"},u=new class{constructor(e){let{baseUrl:t,headers:s}=e;this._baseUrl=t,this._headers=s}_handleResponse(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}initialize(){return Promise.all([this.getUser(),this.getInitialCards()])}getInitialCards(){return fetch("".concat(this._baseUrl,"/cards"),{headers:this._headers}).then((e=>this._handleResponse(e)))}getUser(){return fetch("".concat(this._baseUrl,"/users/me"),{headers:this._headers}).then((e=>this._handleResponse(e)))}setUserInfo(e){let{name:t,about:s}=e;return fetch("".concat(this._baseUrl,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:s})}).then((e=>this._handleResponse(e)))}addCard(e){let{name:t,link:s}=e;return fetch("".concat(this._baseUrl,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:s})}).then((e=>this._handleResponse(e)))}deleteCard(e){return fetch("".concat(this._baseUrl,"/cards/").concat(e),{method:"DELETE",headers:this._headers}).then((e=>this._handleResponse(e)))}toggleLike(e,t){return fetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{method:t?"DELETE":"PUT",headers:this._headers}).then((e=>this._handleResponse(e)))}updateProfilePic(e){let{avatar:t}=e;return fetch("".concat(this._baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:t})}).then((e=>this._handleResponse(e)))}}({baseUrl:"https://around.nomoreparties.co/v1/group-12",headers:{authorization:"388e1377-9ab5-4db7-9c4c-d98eb5bc0391","Content-Type":"application/json"}});class h{constructor(e,t){let{items:s,renderer:r}=e;this._renderedItems=s,this._renderer=r,this._container=t}addItem(e){this._container.prepend(e)}renderItems(){this._renderedItems.forEach((e=>{this._renderer(e)}))}}class d{constructor(e){this._popup=document.querySelector(e),this._handleEscClose=this._handleEscClose.bind(this),this._closePopupOnRemoteClick=this._closePopupOnRemoteClick.bind(this)}open(){this._popup.classList.add("popup_opened"),this._popup.addEventListener("mousedown",this._closePopupOnRemoteClick),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose),this._popup.removeEventListener("mousedown",this._closePopupOnRemoteClick)}_closePopupOnRemoteClick(e){e.target.classList.contains("popup__overlay")&&this.close()}_handleEscClose(e){"Escape"===e.key&&this.close()}setEventListeners(){this._popup.querySelector(".popup__close-btn").addEventListener("click",(()=>this.close()))}renderSaving(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Saving...";this._submitButton.textContent=e?t:this._submitButtonText}}class _ extends d{constructor(e,t){let{handleFormSubmit:s}=t;super(e),this._handleFormSubmit=s,this._form=this._popup.querySelector(".popup__form"),this._inputList=this._form.querySelectorAll(".popup__form-input"),this._submitButton=this._form.querySelector(".popup__button"),this._submitButtonText=this._submitButton.textContent}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues())}))}_getInputValues(){return this._objData={},this._inputList.forEach((e=>{this._objData[e.name]=e.value})),this._objData}setInputValues(e){this._objInput={},this._inputList.forEach((t=>{this._objInput[t.name]=e[t.value]}))}close(){super.close(),this._form.reset()}open(){super.open()}}var p=class{constructor(e,t){this._form=t,this._formSelector=e.formSelector,this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._inputList=[...this._form.querySelectorAll(this._inputSelector)],this._buttonElement=this._form.querySelector(this._submitButtonSelector)}_showInputError(e,t){const s=this._form.querySelector(".".concat(e.id,"-error"));e.classList.add(this._inputErrorClass),s.textContent=t,s.classList.add(this._errorClass)}_hideInputError(e){const t=this._form.querySelector(".".concat(e.id,"-error"));e.classList.remove(this._inputErrorClass),t.classList.remove(this._errorClass),t.textContent=""}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid))}_setEventListeners(){this._toggleButtonState(),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState()}))}))}_toggleButtonState(){this._hasInvalidInput()?(this._buttonElement.classList.add(this._inactiveButtonClass),this._buttonElement.setAttribute("disabled",!0)):(this._buttonElement.classList.remove(this._inactiveButtonClass),this._buttonElement.removeAttribute("disabled"))}enableValidation(){this._form.addEventListener("submit",(function(e){e.preventDefault()})),this._setEventListeners()}resetValidation(){this._toggleButtonState(),this._inputList.forEach((e=>{this._hideInputError(e)}))}};const m=new class extends d{constructor(e,t){super(e),this._form=this._popup.querySelector(".popup__form"),this._handleSubmit=t,this._submitButton=this._form.querySelector(".popup__button"),this._submitButtonText=this._submitButton.textContent}open(e){super.open(),this._card=e}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleSubmit(this._card)}))}}("#delete-popup",(function(e){m.renderSaving(!0),u.deleteCard(e.getCardId()).then((()=>{e.getElement().remove(),m.close()})).catch((e=>{console.log(e)})).finally((()=>{m.renderSaving(!1)}))}));m.setEventListeners(),n.addEventListener("click",(()=>{S.open(),k.resetValidation()}));const v=e=>{const t=new class{constructor(e,t,s,r,n){var i,o;o=e=>{e.target.classList.toggle("card__place-favorite_active")},(i="_handleLikeButton")in this?Object.defineProperty(this,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):this[i]=o,this.handleCardClick=s,this._handleDeleteButton=r,this._cardSelector=t,this._handleLikeButton=n,this._name=e.name,this._link=e.link,this._likes=e.likes,this._ownerId=e.owner._id,this._userId=e.userId,this._id=e._id}updateLikes(e){this._likes=e,this._renderLikes()}isLiked(){return this._likes.some((e=>e._id===this._userId))}_renderLikes(){this._likesTotal.textContent=this._likes.length,this.isLiked()?this._cardElement.querySelector(".card__place-favorite").classList.add("card__place-favorite_active"):this._cardElement.querySelector(".card__place-favorite").classList.remove("card__place-favorite_active")}getCardId(){return this._id}_setEventListeners(){this._cardElement.querySelector(".card__place-favorite").addEventListener("click",this._handleLikeButton),this._trashButton.addEventListener("click",(()=>{this._handleDeleteButton(this._cardElement)})),this._cardElement.querySelector(".card__image").addEventListener("click",(()=>{this.handleCardClick({link:this._link,name:this._name})}))}getElement(){return this._cardElement}_getTemplate(){return document.querySelector(this._cardSelector).content.firstElementChild.cloneNode(!0)}getView(){this._cardElement=this._getTemplate(),this._cardElement.querySelector(".card__place-name").textContent=this._name;const e=this._cardElement.querySelector(".card__image");return this._likesTotal=this._cardElement.querySelector(".card__place-num"),this._trashButton=this._cardElement.querySelector(".card__trash"),this._ownerId!==this._userId&&this._trashButton.remove(),this._renderLikes(),e.src=this._link,e.alt=this._name,this._setEventListeners(),this._cardElement}}(e,"#card-template",(()=>{f(e)}),(()=>{m.open(t)}),(()=>{I(t)}));return t.getView()};u.initialize().then((e=>{const[t,s]=e,r=new h({items:s,renderer:e=>{let s=t._id;r.addItem(v({name:e.name,link:e.link,likes:e.likes,owner:e.owner,_id:e._id,userId:s}))}},l);r.renderItems(),E.setUserInfo({name:t.name,about:t.about,avatar:t.avatar})})).catch((e=>{console.log(e)}));const b=new class extends d{constructor(e){super(e),this._cardImage=document.querySelector(".popup__card-image-preview")}open(e,t){const s=this._cardImage;s.src=t,s.alt=e,document.querySelector(".popup__card-image-preview-name").textContent=e,super.open()}}("#view__image"),f=e=>{b.open(e.name,e.link)},S=new _("#add-place-popup",{handleFormSubmit:e=>{w(e)}});n.addEventListener("click",(()=>{S.open(),k.resetValidation()}));const E=new class{constructor(e){let{nameSelector:t,jobSelector:s,profilePicSelector:r}=e;this._name=document.querySelector(t),this._about=document.querySelector(s),this._profilePic=document.querySelector(r)}getUserInfo(){return{name:this._name.textContent,about:this._about.textContent}}setUserInfo(e){let{name:t,about:s,avatar:r}=e;this._name.textContent=t,this._about.textContent=s,this._profilePic.src=r}}({nameSelector:".profile__edit-name",jobSelector:".profile__about-me",profilePicSelector:".profile__image"}),g=new _("#edit__profile",{handleFormSubmit:e=>{q(e)}});e.addEventListener("click",(()=>{const{name:e,about:r}=E.getUserInfo();t.value=e,s.value=r,g.open(),y.resetValidation()}));const L=new _("#edit-profile-pic-popup",{handleFormSubmit:e=>{B(e)}});L.setEventListeners(),o.addEventListener("click",(()=>{L.open(),C.resetValidation()}));const y=new p(c,r),k=new p(c,i),C=new p(c,a);k.enableValidation(),y.enableValidation(),C.enableValidation(),g.setEventListeners(),b.setEventListeners(),S.setEventListeners();const I=e=>{u.toggleLike(e._id,e.isLiked()).then((t=>{e.updateLikes(t.likes)})).catch((e=>{console.log(e)}))},q=e=>{g.renderSaving(!0),u.setUserInfo(e).then((e=>{E.setUserInfo({name:e.name,about:e.about,avatar:e.avatar})})).catch((e=>{console.log(e)})).finally((()=>{g.renderSaving(!1)})),E.setUserInfo({name:e.name,about:e.about,avatar:e.avatar}),g.close()},w=e=>{g.renderSaving(!0),u.addCard(e).then((e=>{const t=v(e);l.prepend(t)})).catch((e=>{console.log(e)})).finally((()=>{g.renderSaving(!1)})),S.close()},B=e=>{L.renderSaving(!0),u.updateProfilePic(e).then((e=>{E.setUserInfo({name:e.name,about:e.about,avatar:e.avatar})})).catch((e=>{console.log(e)})).finally((()=>{L.renderSaving(!1)})),L.close()}}();
//# sourceMappingURL=main.js.map